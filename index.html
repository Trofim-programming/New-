<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Современные новости онлайн">
    <title>Новости+ (SQLite Version)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        function loadGoogleScripts() {
            const adScript = document.createElement('script');
            adScript.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1861780787527911";
            adScript.async = true;
            adScript.crossOrigin = "anonymous";
            document.head.appendChild(adScript);

            const gaScript = document.createElement('script');
            gaScript.src = "https://www.googletagmanager.com/gtag/js?id=G-GK7EZBSME3";
            gaScript.async = true;
            document.head.appendChild(gaScript);

            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-GK7EZBSME3');
        }
    </script>
    
    <style>
        /* Стили остались прежними для сохранения дизайна */
        :root { --primary: #2563eb; --primary-dark: #1d4ed8; --bg-dark: #0f172a; --bg-card: #1e293b; --text-primary: #f8fafc; --text-secondary: #cbd5e1; --text-muted: #94a3b8; --accent: #06d6a0; --border: #334155; --radius: 12px; --header-height: 70px; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Manrope', sans-serif; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; display: flex; flex-direction: column; }
        
        /* Cookie Banner */
        .cookie-banner { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg-card); border-top: 1px solid var(--primary); padding: 1rem; z-index: 9999; display: none; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); }
        .cookie-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .btn { padding: 10px 20px; border-radius: 8px; cursor: pointer; border: none; font-weight: 600; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: #334155; color: white; }

        /* Ad Label */
        .ad-container { width: 100%; margin: 2rem 0; padding: 10px; background: rgba(255,255,255,0.02); border: 1px dashed var(--border); text-align: center; border-radius: var(--radius); }
        .ad-label { display: block; font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }

        /* Layout */
        header { background: rgba(15,23,42,0.98); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; padding: 0.75rem 1rem; }
        .header-container { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-weight: 700; font-size: 1.5rem; color: white; text-decoration: none; }
        .nav-links { display: flex; gap: 1rem; align-items: center; }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem 1rem; flex: 1; }
        .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .news-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; cursor: pointer; transition: 0.3s; }
        .news-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card-image { height: 200px; width: 100%; object-fit: cover; }
        .card-content { padding: 1.5rem; }
        .card-title { font-size: 1.25rem; margin-bottom: 0.5rem; }
        .card-excerpt { color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem; }
        
        /* Admin Panel */
        .admin-panel { display: none; background: var(--bg-card); border: 1px solid var(--border); padding: 2rem; margin-top: 2rem; border-radius: var(--radius); }
        .form-input, .form-textarea, .form-select { width: 100%; background: var(--bg-dark); border: 1px solid var(--border); padding: 10px; color: white; margin-bottom: 1rem; border-radius: 8px; }
        .form-textarea { min-height: 100px; }
        
        /* Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; padding: 1rem; overflow-y: auto; }
        .modal-content { background: var(--bg-card); max-width: 800px; margin: 2rem auto; padding: 2rem; border-radius: var(--radius); position: relative; }
        .close-modal { position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }
        .modal-image { width: 100%; max-height: 400px; object-fit: cover; border-radius: var(--radius); margin-bottom: 1rem; }

        .filter-btn { background: var(--bg-card); border: 1px solid var(--border); color: var(--text-secondary); padding: 8px 16px; border-radius: 20px; cursor: pointer; margin-right: 5px; margin-bottom: 10px; }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
    </style>
</head>
<body>

    <header>
        <div class="header-container">
            <a href="#" class="logo">Новости+ (SQLite)</a>
            <div class="nav-links">
                <button class="btn btn-primary" id="adminToggle">Админ</button>
                <button class="btn btn-secondary" id="logoutBtn" style="display: none;">Выйти</button>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="ad-container">
            <span class="ad-label">Реклама</span>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-1861780787527911"
                 data-ad-slot="YOUR_AD_SLOT_ID"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <div style="margin-bottom: 2rem;">
            <h2>Последние новости</h2>
            <div id="filters">
                <button class="filter-btn active" data-cat="all">Все</button>
                <button class="filter-btn" data-cat="politics">Политика</button>
                <button class="filter-btn" data-cat="economics">Экономика</button>
                <button class="filter-btn" data-cat="technology">Технологии</button>
            </div>
        </div>

        <div class="news-grid" id="newsGrid">
            <p>Загрузка новостей...</p>
        </div>

        <div class="admin-panel" id="adminPanel">
            <h3>Добавить новость (SQLite)</h3>
            <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; color: #fca5a5; padding: 10px; margin-bottom: 15px; border-radius: 8px; font-size: 0.9rem;">
                <i class="fas fa-exclamation-triangle"></i> <strong>Правила Google:</strong> Запрещены насилие, дискриминация, шокирующий контент.
            </div>

            <input type="text" id="newsTitle" class="form-input" placeholder="Заголовок">
            <select id="newsCategory" class="form-select">
                <option value="politics">Политика</option>
                <option value="economics">Экономика</option>
                <option value="technology">Технологии</option>
            </select>
            <input type="text" id="newsImage" class="form-input" placeholder="URL картинки">
            <textarea id="newsContent" class="form-textarea" placeholder="Текст новости..."></textarea>
            
            <button class="btn btn-primary" id="addNewsBtn">Опубликовать</button>
            
            <div style="margin-top: 2rem;">
                <h4>Управление новостями</h4>
                <div id="adminNewsList"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="newsModal">
        <div class="modal-content">
            <button class="close-modal" onclick="document.getElementById('newsModal').style.display='none'">&times;</button>
            <h2 id="modalTitle"></h2>
            <img id="modalImage" class="modal-image" src="" alt="">
            <p id="modalMeta" style="color: var(--text-muted); margin-bottom: 1rem;"></p>
            <div id="modalText" style="line-height: 1.6;"></div>
            
            <div class="ad-container">
                <span class="ad-label">Реклама</span>
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-1861780787527911"
                     data-ad-slot="YOUR_MODAL_SLOT"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
        </div>
    </div>

    <div class="modal" id="loginModal">
        <div class="modal-content" style="max-width: 400px;">
            <button class="close-modal" onclick="document.getElementById('loginModal').style.display='none'">&times;</button>
            <h3>Вход Админа</h3>
            <input type="email" id="loginEmail" class="form-input" placeholder="Email">
            <input type="password" id="loginPass" class="form-input" placeholder="Пароль">
            <button class="btn btn-primary" id="loginBtn" style="width: 100%;">Войти</button>
        </div>
    </div>

    <div class="cookie-banner" id="cookieBanner">
        <div class="cookie-content">
            <span>Мы используем cookies для работы сайта и рекламы.</span>
            <div>
                <button class="btn btn-secondary" id="declineCookies">Отклонить</button>
                <button class="btn btn-primary" id="acceptCookies">Принять</button>
            </div>
        </div>
    </div>

    <script>
        // API URL (Ваш локальный сервер)
        const API_URL = 'http://localhost:3000/api';
        
        let allNews = [];
        let isAdmin = false;

        document.addEventListener('DOMContentLoaded', () => {
            checkCookies();
            checkAdminStatus();
            loadNews();
            setupEvents();
        });

        // --- Взаимодействие с SQLite через API ---

        async function loadNews() {
            try {
                const res = await fetch(`${API_URL}/news`);
                allNews = await res.json();
                renderNews(allNews);
                if(isAdmin) renderAdminList();
            } catch (e) {
                console.error("Ошибка загрузки:", e);
                document.getElementById('newsGrid').innerHTML = '<p>Ошибка подключения к серверу БД.</p>';
            }
        }

        async function addNews() {
            const title = document.getElementById('newsTitle').value;
            const content = document.getElementById('newsContent').value;
            
            if(!title || !content) return alert('Заполните поля');

            const newsData = {
                title, 
                content,
                category: document.getElementById('newsCategory').value,
                image: document.getElementById('newsImage').value || 'https://via.placeholder.com/400',
                excerpt: content.substring(0, 100) + '...',
                source: 'Редакция'
            };

            const res = await fetch(`${API_URL}/news`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newsData)
            });

            if(res.ok) {
                alert('Новость сохранена в SQLite!');
                document.getElementById('newsTitle').value = '';
                document.getElementById('newsContent').value = '';
                loadNews();
            } else {
                alert('Ошибка сохранения');
            }
        }

        async function deleteNews(id) {
            if(!confirm('Удалить?')) return;
            await fetch(`${API_URL}/news/${id}`, { method: 'DELETE' });
            loadNews();
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPass').value;

            const res = await fetch(`${API_URL}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            const data = await res.json();
            if(data.success) {
                localStorage.setItem('adminToken', data.token);
                window.location.reload();
            } else {
                alert(data.error);
            }
        }

        // --- Интерфейс ---

        function renderNews(newsList) {
            const grid = document.getElementById('newsGrid');
            grid.innerHTML = newsList.map(n => `
                <div class="news-card" onclick="openDetail(${n.id})">
                    <img src="${n.image}" class="card-image" loading="lazy">
                    <div class="card-content">
                        <span style="background:var(--primary); padding:2px 8px; border-radius:10px; font-size:0.7rem;">${n.category}</span>
                        <h3 class="card-title">${n.title}</h3>
                        <p class="card-excerpt">${n.excerpt}</p>
                        <small style="color:var(--text-muted)">${new Date(n.createdAt).toLocaleDateString()}</small>
                    </div>
                </div>
            `).join('');
        }

        function openDetail(id) {
            const n = allNews.find(item => item.id === id);
            if(!n) return;
            document.getElementById('modalTitle').innerText = n.title;
            document.getElementById('modalImage').src = n.image;
            document.getElementById('modalMeta').innerText = `${new Date(n.createdAt).toLocaleDateString()} | ${n.source}`;
            document.getElementById('modalText').innerText = n.content;
            document.getElementById('newsModal').style.display = 'block';
        }

        function renderAdminList() {
            const list = document.getElementById('adminNewsList');
            list.innerHTML = allNews.map(n => `
                <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333;">
                    <span>${n.title}</span>
                    <button class="btn btn-primary" style="background:#ef4444; padding:5px 10px;" onclick="event.stopPropagation(); deleteNews(${n.id})">Удалить</button>
                </div>
            `).join('');
        }

        function checkAdminStatus() {
            if(localStorage.getItem('adminToken')) {
                isAdmin = true;
                document.getElementById('logoutBtn').style.display = 'block';
            }
        }

        // --- Cookies & Events ---
        
        function checkCookies() {
            const consent = localStorage.getItem('cookieConsent');
            if(consent === 'accepted') loadGoogleScripts();
            else if(!consent) document.getElementById('cookieBanner').style.display = 'block';
        }

        function setupEvents() {
            document.getElementById('acceptCookies').onclick = () => {
                localStorage.setItem('cookieConsent', 'accepted');
                document.getElementById('cookieBanner').style.display = 'none';
                loadGoogleScripts();
            };
            document.getElementById('declineCookies').onclick = () => {
                localStorage.setItem('cookieConsent', 'declined');
                document.getElementById('cookieBanner').style.display = 'none';
            };
            
            document.getElementById('adminToggle').onclick = () => {
                if(isAdmin) document.getElementById('adminPanel').style.display = 'block';
                else document.getElementById('loginModal').style.display = 'block';
            };

            document.getElementById('loginBtn').onclick = login;
            document.getElementById('logoutBtn').onclick = () => {
                localStorage.removeItem('adminToken');
                window.location.reload();
            };
            document.getElementById('addNewsBtn').onclick = addNews;

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.onclick = (e) => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    const cat = e.target.dataset.cat;
                    const filtered = cat === 'all' ? allNews : allNews.filter(n => n.category === cat);
                    renderNews(filtered);
                }
            });
        }
    </script>
</body>
</html>
